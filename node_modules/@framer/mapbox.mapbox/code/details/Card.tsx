import * as React from "react";
import { MapLocation } from "./MapTypes";
import { Marker, Popup } from "react-map-gl";
import "./Card.css"

interface Props extends MapLocation {
  offsetLeft: number
  offsetTop: number
  onClick?: () => void
}

const createCustomCard = (card: React.ReactElement<any>) => {
  const customCard = (props: Props) => {
    const {
      location,
      offsetLeft,
      offsetTop,
      name,
      category,
      details,
      onClick
    } = props

    return (
      <Marker
        className="onTopOfSearchInputStyle"
        longitude={location.longitude}
        latitude={location.latitude}
      >
        {React.cloneElement(card, {
          left: -(card.props.width / 2) + offsetLeft,
          top: -(card.props.height / 2) + offsetTop,
          name,
          category,
          details,
          onClick,
        })}
      </Marker>
    )
  }

  return customCard
}

const defaultCard = (props: Props) => {
  const {
    location,
    offsetLeft,
    offsetTop,
    name,
    category,
    details,
    onClick,
  } = props

  return (
    <Popup
      className="onTopOfSearchInputStyle"
      longitude={location.longitude}
      latitude={location.latitude}
      offsetLeft={offsetLeft}
      offsetTop={offsetTop}
      onClose={onClick}
    >
      <h1>{name}</h1>
      <p>{category}</p>
      <p>{details}</p>
    </Popup>
  )
}

const getCardElementType = (cardNode: React.ReactNodeArray) => {
  if (cardNode && cardNode.length > 0) {
    const card: React.ReactElement<any> = cardNode[0] as React.ReactElement<any>
    return createCustomCard(card)
  }
  return defaultCard;
}

export default getCardElementType
