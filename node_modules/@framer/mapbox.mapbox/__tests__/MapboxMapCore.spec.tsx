import * as React from "react"
import { MapboxMapCore, Props, State } from "../code/details/MapboxMapCore"
import { shallow } from "enzyme"
import { ViewState } from "react-map-gl";

describe("MapboxMapCore", () => {
  it("updates viewport properties from new props", () => {
    const wrapper = shallow(<MapboxMapCore {...MapboxMapCore.defaultProps} />)
    const pp = {
      width: 100,
      height: 200,
      longitude: 50,
      latitude: 40,
      bearing: 30,
      pitch: 20,
      zoom: 10,
      accessTokenURL: "test_accessTokenURL",
      anonymousStyle: "test_anonymousStyle",
      authenticatedStyle: "test_authenticatedStyle",
      userStyle: "test_userStyle",
      showLocationText: false,
    }

    wrapper.setProps(pp)
    const state: State = wrapper.state() as State

    expect(state.viewport.width).toEqual(100)
    expect(state.viewport.height).toEqual(200)
    expect(state.viewport.longitude).toEqual(50)
    expect(state.viewport.latitude).toEqual(40)
    expect(state.viewport.bearing).toEqual(30)
    expect(state.viewport.pitch).toEqual(20)
    expect(state.viewport.zoom).toEqual(10)
  })

  it('onViewportChange does not remove width and height', () => {
    const wrapper = shallow(<MapboxMapCore {...MapboxMapCore.defaultProps} />)
    const viewport: ViewState = {
      latitude: 0,
      zoom: 0,
      longitude: 0,
    }
    const _instance: MapboxMapCore = wrapper.instance() as MapboxMapCore
    _instance._updateViewport(viewport)

    const state: State = wrapper.state() as State
    expect(state.viewport.width).toEqual(375)
    expect(state.viewport.height).toEqual(375)
  })
})
